<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fitly - Virtual Try-On</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Symbols+Outlined" rel="stylesheet">
    <link rel="stylesheet" href="sidebar.css?v=3">
</head>

<body>
    <div id="app">
        <!-- Header - Compact Minimalist -->
        <header class="header">
            <div class="logo">
                <div class="logo-icon">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 2L2 7L12 12L22 7L12 2Z" fill="currentColor" />
                        <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round" />
                        <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round" />
                    </svg>
                </div>
                <span class="logo-text">Fitly</span>
            </div>

            <div class="header-actions">
                <!-- Compact Gems Display -->
                <button id="gems-display" class="gems-badge compact" title="Mua th√™m gems">
                    <span class="material-symbols-outlined gem-icon">diamond</span>
                    <span id="gems-count" class="gem-count">49</span>
                </button>

                <!-- Profile Trigger - Avatar + Text -->
                <div class="profile-wrapper">
                    <button id="profile-btn" class="profile-trigger" title="T√†i kho·∫£n">
                        <!-- Content injected by JS -->
                    </button>

                    <!-- Expanded Profile Dropdown Menu -->
                    <div id="profile-menu" class="profile-dropdown hidden">
                        <!-- User Info Header -->
                        <div class="menu-header">
                            <div class="menu-avatar-large" id="menu-avatar">
                                <!-- Avatar injected by JS -->
                            </div>
                            <div class="menu-user-info">
                                <p id="menu-username" class="menu-username">Guest User</p>
                                <p id="menu-email" class="menu-email">Sign in to sync</p>
                            </div>
                        </div>

                        <div class="profile-menu-items">
                            <!-- Language -->
                            <button class="profile-menu-item" id="menu-language">
                                <span class="material-symbols-outlined menu-icon">language</span>
                                <span class="menu-item-text">Ng√¥n ng·ªØ / Language</span>
                                <span id="current-lang-code" class="menu-item-value">VI</span>
                            </button>

                            <div class="profile-menu-spacer hidden"></div>

                            <!-- Wardrobe (t·∫°m ·∫©n) -->
                            <button class="profile-menu-item auth-only hidden" id="menu-wardrobe">
                                <span class="material-symbols-outlined menu-icon">checkroom</span>
                                <span class="menu-item-text">T·ªß ƒë·ªì c·ªßa t√¥i</span>
                            </button>

                            <!-- Gallery (t·∫°m ·∫©n) -->
                            <button class="profile-menu-item auth-only hidden" id="menu-gallery">
                                <span class="material-symbols-outlined menu-icon">collections</span>
                                <span class="menu-item-text">B·ªô s∆∞u t·∫≠p</span>
                            </button>

                            <!-- Web App (t·∫°m ·∫©n) -->
                            <button class="profile-menu-item auth-only hidden" id="menu-webapp">
                                <span class="material-symbols-outlined menu-icon">open_in_new</span>
                                <span class="menu-item-text">M·ªü Web App</span>
                            </button>

                            <!-- Buy Gems Shortcut (t·∫°m ·∫©n) -->
                            <button class="profile-menu-item auth-only hidden" id="menu-credits">
                                <span class="material-symbols-outlined menu-icon">diamond</span>
                                <span class="menu-item-text">Mua th√™m Gems</span>
                            </button>

                            <div class="profile-menu-spacer hidden"></div>

                            <!-- Cache Settings (t·∫°m ·∫©n) -->
                            <button class="profile-menu-item auth-only hidden" id="menu-cache-settings">
                                <span class="material-symbols-outlined menu-icon">cleaning_services</span>
                                <span class="menu-item-text">X√≥a Cache</span>
                                <span id="menu-cache-size" class="menu-item-value">0 MB</span>
                            </button>

                            <!-- Help -->
                            <button class="profile-menu-item auth-only" id="menu-help">
                                <span class="material-symbols-outlined menu-icon">help</span>
                                <span class="menu-item-text">Tr·ª£ gi√∫p</span>
                            </button>

                            <div class="profile-menu-spacer auth-only"></div>

                            <!-- Login (Guest Only) -->
                            <button class="profile-menu-item guest-only" id="menu-login">
                                <span class="material-symbols-outlined menu-icon" style="color: #4caf50;">login</span>
                                <span class="menu-item-text">ƒêƒÉng nh·∫≠p</span>
                            </button>

                            <!-- Logout (Auth Only) -->
                            <button class="profile-menu-item auth-only text-danger" id="menu-logout">
                                <span class="material-symbols-outlined menu-icon">logout</span>
                                <span class="menu-item-text">ƒêƒÉng xu·∫•t</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Gems Purchase Panel (hidden by default) -->
        <section id="gems-panel" class="gems-panel hidden">
            <div class="gems-panel-header">
                <h3>
                    <span class="material-symbols-outlined" style="color: #29b6f6;">diamond</span>
                    Mua Gems
                </h3>
                <button id="close-gems-panel" class="close-btn">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
            <p class="gems-panel-subtitle">
                S·ªë d∆∞: <span id="gems-panel-balance">0</span>
                <span class="material-symbols-outlined"
                    style="font-size: 16px; vertical-align: text-bottom; color: #29b6f6;">diamond</span>
            </p>

            <div class="gem-packages">
                <!-- Starter -->
                <button class="gem-package" data-package="starter">
                    <div class="package-icon-wrapper">
                        <span class="material-symbols-outlined" style="color: #fbc02d;">bolt</span>
                    </div>
                    <div class="package-info">
                        <span class="package-name">G√≥i Kh·ªüi ƒê·∫ßu</span>
                        <span class="package-gems">50 <span class="material-symbols-outlined"
                                style="font-size: 14px; margin-left: 2px;">diamond</span></span>
                    </div>
                    <span class="package-price">49.000 <small>ƒë</small></span>
                </button>

                <!-- Pro (Popular) -->
                <button class="gem-package popular" data-package="pro">
                    <div class="popular-badge-container">
                        <span class="badge-text">Ph·ªï<br>bi·∫øn</span>
                    </div>
                    <div class="package-icon-wrapper">
                        <span class="material-symbols-outlined" style="color: #fdd835;">auto_awesome</span>
                    </div>
                    <div class="package-info">
                        <span class="package-name">G√≥i Pro</span>
                        <span class="package-gems">150 <span class="material-symbols-outlined"
                                style="font-size: 14px; margin-left: 2px;">diamond</span></span>
                    </div>
                    <span class="package-price">129.000 <small>ƒë</small></span>
                </button>

                <!-- Premium -->
                <button class="gem-package" data-package="premium">
                    <div class="package-icon-wrapper">
                        <span style="font-size: 24px;">üëë</span>
                    </div>
                    <div class="package-info">
                        <span class="package-name">G√≥i Premium</span>
                        <span class="package-gems">500 <span class="material-symbols-outlined"
                                style="font-size: 14px; margin-left: 2px;">diamond</span></span>
                    </div>
                    <span class="package-price">399.000 <small>ƒë</small></span>
                </button>
            </div>

            <p class="gems-panel-note">Thanh to√°n an to√†n qua Stripe tr√™n web app</p>
        </section>

        <!-- Language Selector Panel (hidden by default) -->
        <section id="language-panel" class="language-panel hidden">
            <div class="language-panel-header">
                <h3>üåê Ng√¥n ng·ªØ / Language</h3>
                <button id="close-language-panel" class="close-btn">√ó</button>
            </div>

            <div class="language-options">
                <button class="language-option" data-lang="vi">
                    <span class="lang-flag">üáªüá≥</span>
                    <span class="lang-name">Ti·∫øng Vi·ªát</span>
                </button>
                <button class="language-option" data-lang="en">
                    <span class="lang-flag">üá∫üá∏</span>
                    <span class="lang-name">English</span>
                </button>
                <button class="language-option" data-lang="ja">
                    <span class="lang-flag">üáØüáµ</span>
                    <span class="lang-name">Êó•Êú¨Ë™û</span>
                </button>
                <button class="language-option" data-lang="ko">
                    <span class="lang-flag">üá∞üá∑</span>
                    <span class="lang-name">ÌïúÍµ≠Ïñ¥</span>
                </button>
                <button class="language-option" data-lang="zh">
                    <span class="lang-flag">üá®üá≥</span>
                    <span class="lang-name">‰∏≠Êñá</span>
                </button>
                <button class="language-option" data-lang="th">
                    <span class="lang-flag">üáπüá≠</span>
                    <span class="lang-name">‡πÑ‡∏ó‡∏¢</span>
                </button>
                <button class="language-option" data-lang="id">
                    <span class="lang-flag">üáÆüá©</span>
                    <span class="lang-name">Bahasa Indonesia</span>
                </button>
                <button class="language-option" data-lang="es">
                    <span class="lang-flag">üá™üá∏</span>
                    <span class="lang-name">Espa√±ol</span>
                </button>
                <button class="language-option" data-lang="fr">
                    <span class="lang-flag">üá´üá∑</span>
                    <span class="lang-name">Fran√ßais</span>
                </button>
            </div>
        </section>

        <!-- Auth Section (Redesigned) -->
        <section id="auth-section" class="section auth-section hidden">
            <!-- Auth Tabs -->
            <div class="auth-tabs">
                <button class="auth-tab active" data-tab="login">ƒêƒÉng nh·∫≠p</button>
                <button class="auth-tab" data-tab="register">ƒêƒÉng k√Ω</button>
            </div>

            <!-- Login Form -->
            <div id="login-form" class="auth-form">
                <div class="form-header">
                    <h3>Ch√†o m·ª´ng tr·ªü l·∫°i! üëã</h3>
                    <p>ƒêƒÉng nh·∫≠p ƒë·ªÉ ƒë·ªìng b·ªô t·ªß ƒë·ªì c·ªßa b·∫°n</p>
                </div>

                <div class="input-group">
                    <span class="material-symbols-outlined input-icon">mail</span>
                    <input type="email" id="login-email" placeholder="Email" autocomplete="email">
                </div>

                <div class="input-group">
                    <span class="material-symbols-outlined input-icon">lock</span>
                    <input type="password" id="login-password" placeholder="M·∫≠t kh·∫©u" autocomplete="current-password">
                    <button class="toggle-password" type="button">
                        <span class="material-symbols-outlined">visibility_off</span>
                    </button>
                </div>

                <div class="form-actions">
                    <label class="checkbox-container">
                        <input type="checkbox" checked>
                        <span class="checkmark"></span>
                        Ghi nh·ªõ t√¥i
                    </label>
                    <a href="#" class="forgot-password">Qu√™n m·∫≠t kh·∫©u?</a>
                </div>

                <button id="login-submit-btn" class="btn btn-primary btn-full">
                    ƒêƒÉng nh·∫≠p
                </button>
            </div>

            <!-- Register Form -->
            <div id="register-form" class="auth-form hidden">
                <div class="form-header">
                    <h3>T·∫°o t√†i kho·∫£n m·ªõi üöÄ</h3>
                    <p>Kh√°m ph√° phong c√°ch c·ªßa ri√™ng b·∫°n</p>
                </div>

                <div class="input-group">
                    <span class="material-symbols-outlined input-icon">person</span>
                    <input type="text" id="register-name" placeholder="H·ªç v√† t√™n" autocomplete="name">
                </div>

                <div class="input-group">
                    <span class="material-symbols-outlined input-icon">mail</span>
                    <input type="email" id="register-email" placeholder="Email" autocomplete="email">
                </div>

                <div class="input-group">
                    <span class="material-symbols-outlined input-icon">lock</span>
                    <input type="password" id="register-password" placeholder="M·∫≠t kh·∫©u" autocomplete="new-password">
                </div>

                <div class="input-group">
                    <span class="material-symbols-outlined input-icon">lock_reset</span>
                    <input type="password" id="register-confirm-password" placeholder="X√°c nh·∫≠n m·∫≠t kh·∫©u"
                        autocomplete="new-password">
                </div>

                <button id="register-submit-btn" class="btn btn-primary btn-full">
                    ƒêƒÉng k√Ω ngay
                </button>
            </div>

            <!-- Social Login Divider -->
            <div class="auth-divider">
                <span>Ho·∫∑c ti·∫øp t·ª•c v·ªõi</span>
            </div>

            <div class="social-login-grid">
                <button id="login-google-btn" class="social-btn google" title="Google">
                    <img src="https://www.vectorlogo.zone/logos/google/google-icon.svg" alt="Google">
                </button>
                <button id="login-facebook-btn" class="social-btn facebook" title="Facebook">
                    <img src="https://www.svgrepo.com/show/475647/facebook-color.svg" alt="Facebook">
                </button>
                <button id="login-apple-btn" class="social-btn apple" title="Apple">
                    <img src="https://www.vectorlogo.zone/logos/apple/apple-tile.svg" alt="Apple">
                </button>
            </div>

            <!-- Guest Mode -->
            <button id="skip-login-btn" class="btn-text-only">
                D√πng th·ª≠ kh√¥ng c·∫ßn ƒëƒÉng nh·∫≠p ‚Üí
            </button>
        </section>

        <!-- Main Content (shown when logged in) -->
        <main id="main-content" class="main-body hidden">
            <!-- Demo Mode Banner -->
            <div id="demo-banner" class="demo-banner">
                üß™ Demo Mode - D·ªØ li·ªáu m·∫´u
            </div>

            <!-- Model Section -->
            <!-- Model Section Redesigned - Main Image on Top + Thumbnails Below -->
            <section class="section model-redesign-section">
                <div class="section-header">
                    <h3>·∫¢nh m·∫´u to√†n th√¢n</h3>
                </div>

                <div class="model-view-container">
                    <!-- Main Model Display (Top - Full Width) -->
                    <div id="model-image-container" class="image-container model-container">
                        <div id="model-placeholder" class="placeholder empty-state minimal">
                            <div class="empty-icon-circle minimal">
                                <span class="material-symbols-outlined">add_a_photo</span>
                            </div>
                            <span class="empty-label">TH√äM ·∫¢NH</span>
                            <span class="empty-instruction">·∫¢nh to√†n th√¢n</span>
                        </div>
                        <img id="model-image" class="preview-image hidden" alt="Model">
                        
                        <!-- Action Buttons on Main Image (shown when image is loaded) -->
                        <div id="main-image-actions" class="main-image-actions hidden">
                            <button id="main-pin-btn" class="main-action-btn pin-btn" title="ƒê·∫∑t l√†m ·∫£nh m·∫∑c ƒë·ªãnh">
                                <span class="material-symbols-outlined">push_pin</span>
                                <span class="btn-label">ƒê·∫∑t m·∫∑c ƒë·ªãnh</span>
                            </button>
                            <button id="main-delete-btn" class="main-action-btn delete-btn" title="X√≥a ·∫£nh n√†y">
                                <span class="material-symbols-outlined">delete</span>
                                <span class="btn-label">X√≥a</span>
                            </button>
                        </div>
                    </div>

                    <!-- Horizontal Scrollable Thumbnails (Bottom) -->
                    <div id="user-models-grid" class="user-models-grid-vertical">
                        <!-- Items injected by JS -->
                    </div>
                </div>

                <input type="file" id="model-upload-input" accept="image/*" hidden>
            </section>

            <!-- Mix Match Section (New Design) -->
            <section class="mix-match-wrapper">

                <!-- Top Card: Visual 2D (Replaces Product Section) -->
                <div class="visual-card">
                    <div class="visual-header">Item ƒë√£ ch·ªçn</div>

                    <div id="clothing-image-container" class="visual-image-container">
                        <!-- Placeholder -->
                        <div id="clothing-placeholder" class="visual-placeholder">
                            <i class="material-symbols-outlined placeholder-icon">checkroom</i>
                            <span>Ch∆∞a ch·ªçn ƒë·ªì</span>
                        </div>

                        <!-- Image -->
                        <img id="clothing-image" class="visual-img hidden" alt="Clothing">

                        <!-- Selected Items Bubbles (New Design) -->
                        <div id="selected-items-bubbles" class="selected-items-bubbles">
                            <!-- Injected via JS -->
                        </div>

                        <!-- Floating Mock Tags (Only visible when image is loaded) -->
                        <div class="floating-tag tag-left hidden" id="tag-top">
                            <span class="tag-dot"></span> √Åo Polo
                        </div>
                        <div class="floating-tag tag-right hidden" id="tag-bottom">
                            <span class="tag-dot"></span> Qu·∫ßn T√¢y
                        </div>
                    </div>
                </div>

                <!-- Bottom Section: Selection (Replaces History) -->
                <div class="selection-section" id="clothing-history-section"> <!-- Retain ID for JS -->

                    <div class="selection-header">
                        <div class="selection-title-group">
                            <span class="material-symbols-outlined selection-icon">style</span>
                            <div class="selection-text">
                                <h3>Ch·ªçn ƒë·ªì ph·ªëi</h3>
                                <p>Ch·ªçn 1 m√≥n t·ª´ m·ªói danh m·ª•c ƒë·ªÉ th·ª≠ ƒë·ªì</p>
                            </div>
                        </div>
                        <button id="open-wardrobe-btn" class="section-action">T·ªß ƒë·ªì c·ªßa b·∫°n</button>
                    </div>

                    <!-- Tabs -->
                    <div class="category-tabs" id="category-tabs">
                        <button class="cat-tab active" data-category="top">√Åo</button>
                        <button class="cat-tab" data-category="bottom">Qu·∫ßn</button>
                        <button class="cat-tab" data-category="dress">V√°y</button>
                        <button class="cat-tab" data-category="shoes">Gi√†y</button>
                        <button class="cat-tab" data-category="accessories">Ph·ª• ki·ªán</button>
                    </div>

                    <!-- Carousel (Reusing Grid ID) -->
                    <div id="clothing-history-grid" class="item-carousel">
                        <!-- JS injects items here -->
                    </div>

                    <!-- Action Button -->
                    <button id="try-on-btn" class="try-on-pill-btn" disabled>
                        <div class="try-count-badge">2</div>
                        Th·ª≠ 2 m√≥n ƒë·ªì ngay
                    </button>

                </div>
            </section>

            <!-- Inline Result Section (Latest Result) -->
            <section id="inline-result-section" class="section inline-result-section hidden">
                <div class="section-header">
                    <h3>
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2L2 7l10 5 10-5-10-5z" />
                            <path d="M2 17l10 5 10-5" />
                            <path d="M2 12l10 5 10-5" />
                        </svg>
                        K·∫øt qu·∫£ m·ªõi nh·∫•t
                    </h3>
                    <button id="view-all-results-btn" class="section-action">Xem t·∫•t c·∫£</button>
                </div>

                <!-- Result Image Container -->
                <div class="inline-result-container">
                    <img id="inline-result-image" class="inline-result-image" src="" alt="Try-on result" />
                </div>

                <!-- Action Buttons -->
                <div class="inline-result-actions">
                    <button id="result-download-btn" class="result-action-btn" title="T·∫£i v·ªÅ">
                        <span class="material-symbols-outlined">download</span>
                    </button>
                    <button id="result-copy-btn" class="result-action-btn" title="Copy ·∫£nh">
                        <span class="material-symbols-outlined">content_copy</span>
                    </button>
                    <button id="result-save-btn" class="result-action-btn" title="L∆∞u v√†o t·ªß ƒë·ªì">
                        <span class="material-symbols-outlined">bookmark_border</span>
                    </button>
                    <button id="result-share-btn" class="result-action-btn" title="Chia s·∫ª">
                        <span class="material-symbols-outlined">share</span>
                    </button>
                    <button id="result-use-model-btn" class="result-action-btn" title="S·ª≠ d·ª•ng l√†m ·∫£nh m·∫´u">
                        <span class="material-symbols-outlined">person</span>
                    </button>
                    <button id="result-popup-btn" class="result-action-btn" title="M·ªü popup ri√™ng">
                        <span class="material-symbols-outlined">open_in_new</span>
                    </button>
                </div>

                <!-- Edit Section -->
                <div class="inline-edit-section">
                    <div class="edit-input-group">
                        <input type="text" id="inline-edit-input" class="edit-input"
                            placeholder="Nh·∫≠p y√™u c·∫ßu ch·ªânh s·ª≠a..." />
                        <button id="inline-edit-btn" class="edit-submit-btn" title="Ch·ªânh s·ª≠a">
                            <span class="material-symbols-outlined">edit_square</span>
                        </button>
                    </div>
                    <div class="edit-suggestions">
                        <button class="edit-suggestion-btn" data-suggestion="ƒë·ªïi m√†u √°o sang ƒëen">M√†u ƒëen</button>
                        <button class="edit-suggestion-btn" data-suggestion="th√™m k√≠nh r√¢m">+K√≠nh</button>
                        <button class="edit-suggestion-btn" data-suggestion="th√™m m≈©">+M≈©</button>
                        <button class="edit-suggestion-btn" data-suggestion="x√≥a background">X√≥a n·ªÅn</button>
                    </div>
                </div>

                <!-- Report Wrong -->
                <div class="inline-result-footer">
                    <button id="report-wrong-btn" class="report-wrong-btn">
                        ·∫¢nh sai? Ho√†n gem üíé
                    </button>
                </div>
            </section>

            <!-- Created Outfits - Horizontal List -->
            <section id="created-outfits-list-section" class="section created-outfits-section hidden">
                <div class="section-header">
                    <h3>
                        <span class="material-symbols-outlined">checkroom</span>
                        Outfit v·ª´a t·∫°o
                    </h3>
                    <button id="view-gallery-btn" class="section-action">Xem t·∫•t c·∫£</button>
                </div>
                <div id="created-outfits-list" class="horizontal-outfits-scroll">
                    <!-- Outfits injected by JS -->
                </div>
            </section>





            <!-- Keyboard Shortcuts Hint -->
            <div class="shortcuts-hint">
                <span title="V: D√°n URL | T: Th·ª≠ ƒë·ªì | C: Copy | R: ƒê·ªïi t√™n | 1-9: M·ªü k·∫øt qu·∫£ | Esc: ƒê√≥ng">
                    ‚å®Ô∏è Ph√≠m t·∫Øt: <kbd>V</kbd> <kbd>T</kbd> <kbd>C</kbd> <kbd>R</kbd> <kbd>1-9</kbd>
                </span>
            </div>

        </main>

        <!-- Wardrobe Page Section (Full Screen) -->
        <section id="wardrobe-section" class="section wardrobe-section hidden">
            <!-- Header -->
            <div class="wardrobe-header">
                <div class="wardrobe-title-bar">
                    <button id="close-wardrobe-btn" class="icon-btn-plain">
                        <span class="material-symbols-outlined">arrow_back</span>
                    </button>
                    <h2>T·ªß ƒë·ªì c·ªßa b·∫°n</h2>
                    <div class="wardrobe-actions">
                        <span class="wardrobe-count" id="wardrobe-total-count">0 items</span>
                    </div>
                </div>

                <!-- Search & Filter Bar -->
                <div class="wardrobe-tools">
                    <div class="search-box">
                        <span class="material-symbols-outlined search-icon">search</span>
                        <input type="text" id="wardrobe-search" placeholder="T√¨m ki·∫øm...">
                        <button id="wardrobe-search-clear" class="hidden">
                            <span class="material-symbols-outlined">close</span>
                        </button>
                    </div>
                    <button id="wardrobe-sort-btn" class="icon-btn-plain" title="S·∫Øp x·∫øp">
                        <span class="material-symbols-outlined">sort</span>
                    </button>
                </div>

                <!-- Categories Tabs (Scrollable) -->
                <div class="wardrobe-categories scroll-hide">
                    <button class="wardrobe-cat-tab active" data-category="all">T·∫•t c·∫£</button>
                    <button class="wardrobe-cat-tab" data-category="top">√Åo</button>
                    <button class="wardrobe-cat-tab" data-category="bottom">Qu·∫ßn</button>
                    <button class="wardrobe-cat-tab" data-category="dress">V√°y</button>
                    <button class="wardrobe-cat-tab" data-category="shoes">Gi√†y</button>
                    <button class="wardrobe-cat-tab" data-category="accessories">Ph·ª• ki·ªán</button>
                </div>
            </div>

            <!-- Grid Content -->
            <div id="wardrobe-grid" class="wardrobe-grid scroll-y">
                <!-- Wardrobe items injected by JS -->
            </div>

            <!-- Empty State (Hidden) -->
            <div id="wardrobe-empty" class="wardrobe-empty hidden">
                <div class="empty-icon-circle">
                    <span class="material-symbols-outlined">checkroom</span>
                </div>
                <h3>T·ªß ƒë·ªì tr·ªëng tr∆°n!</h3>
                <p>H√£y chu·ªôt ph·∫£i v√†o ·∫£nh qu·∫ßn √°o tr√™n web ƒë·ªÉ th√™m v√†o ƒë√¢y nh√©.</p>
            </div>
        </section>

        <!-- Share Lookbook Section -->
        <section id="share-lookbook-section" class="section share-section hidden">
            <!-- Header -->
            <div class="share-header">
                <button id="close-share-btn" class="icon-btn-plain">
                    <span class="material-symbols-outlined">arrow_back</span>
                </button>
                <h2 class="share-title">The Lookbook</h2>
                <button class="icon-btn-plain">
                    <span class="material-symbols-outlined">more_horiz</span>
                </button>
            </div>

            <!-- Scrollable Content -->
            <div class="share-content">
                <!-- Lookbook Card -->
                <div id="lookbook-card" class="lookbook-card">
                    <div class="lookbook-brand">GEMINI STYLIST</div>

                    <!-- Images Container (1 or 2 images) -->
                    <div id="lookbook-images" class="lookbook-images-container">
                        <!-- Injected via JS -->
                    </div>

                    <!-- Editable Text -->
                    <div class="lookbook-caption-container">
                        <div class="lookbook-divider"></div>
                        <div id="lookbook-caption" class="lookbook-caption" contenteditable="true" spellcheck="false">
                            Help me choose the perfect fit for tonight's gala ‚ú®
                        </div>
                        <div class="lookbook-subcaption">SPRING COLLECTION 2024</div>
                    </div>

                    <!-- Reaction Buttons (Decorative) -->
                    <div class="lookbook-reactions">
                        <button class="reaction-circle pink"><span
                                class="material-symbols-outlined">favorite</span></button>
                        <button class="reaction-circle yellow"><span
                                class="material-symbols-outlined">auto_awesome</span></button>
                        <button class="reaction-circle white"><span
                                class="material-symbols-outlined">question_mark</span></button>
                    </div>
                </div>

                <!-- Share to Socials -->
                <div class="share-socials-section">
                    <h3 class="share-section-title">Share to Socials</h3>
                    <div class="social-grid">
                        <button class="social-item" data-platform="instagram">
                            <div class="social-icon-circle instagram">
                                <img src="../assets/icon-instagram.svg" alt="IG"
                                    onerror="this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjZmZmIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCI+PHJlY3QgeD0iMiIgeT0iMiIgd2lkdGg9IjIwIiBoZWlnaHQ9IjIwIiByeD0iNSIgcnk9IjUiLz48cGF0aCBkPSJNMTYgMTEuMzdBNCADIDAgMSAxIDEyLjYzIDggNCA0IDAgMCAxIDE2IDExLjM3eiIvPjxsaW5lIHgxPSIxNy41IiB5MT0iNi41IiB4Mj0iMTcuNTEiIHkyPSI2LjUiLz48L3N2Zz4='">
                            </div>
                            <span class="social-label">Story</span>
                        </button>
                        <button class="social-item" data-platform="twitter">
                            <div class="social-icon-circle twitter">
                                <span class="social-text-icon">ùïè</span>
                            </div>
                            <span class="social-label">X</span>
                        </button>
                        <button class="social-item" data-platform="telegram">
                            <div class="social-icon-circle telegram">
                                <span class="material-symbols-outlined">send</span>
                            </div>
                            <span class="social-label">Send</span>
                        </button>
                        <button class="social-item" data-platform="more">
                            <div class="social-icon-circle more">
                                <span class="material-symbols-outlined">more_horiz</span>
                            </div>
                            <span class="social-label">More</span>
                        </button>
                    </div>
                </div>

                <!-- Copy Link -->
                <div class="copy-link-card">
                    <div class="link-icon-circle">
                        <span class="material-symbols-outlined">link</span>
                    </div>
                    <div class="link-info">
                        <span class="link-label">STYLIST LINK</span>
                        <span class="link-url">fitly.app/share/x839z...</span>
                    </div>
                    <button id="copy-link-btn" class="copy-pill-btn">Copy</button>
                </div>
            </div>

            <!-- Bottom Button -->
            <div class="share-footer">
                <button id="download-final-btn" class="download-block-btn">
                    DOWNLOAD LOOKBOOK <span class="material-symbols-outlined">arrow_downward</span>
                </button>
            </div>
        </section>

        <section id="result-section" class="section gallery-section hidden">
            <!-- Gallery Header -->
            <div class="gallery-header-top">
                <div class="gallery-title-group">
                    <div class="gallery-subtitle">
                        <span class="material-symbols-outlined sparkle-icon">auto_awesome</span>
                        B·ªò S∆ØU T·∫¨P
                    </div>
                    <h2 class="gallery-title">Th∆∞ vi·ªán ·∫£nh</h2>
                </div>
                <div class="gallery-actions">
                    <button class="icon-btn-circle" title="B·ªô l·ªçc">
                        <span class="material-symbols-outlined">tune</span>
                    </button>
                    <button id="close-gallery-btn" class="icon-btn-circle" title="ƒê√≥ng">
                        <span class="material-symbols-outlined">close</span>
                    </button>
                </div>
            </div>

            <!-- Tabs -->
            <div class="gallery-tabs">
                <button class="gallery-tab active" data-tab="latest">M·ªõi nh·∫•t</button>
                <button class="gallery-tab" data-tab="shared">ƒê√£ chia s·∫ª</button>
                <button class="gallery-tab" data-tab="draft">Nh√°p</button>
                <button class="gallery-tab" data-tab="archived">L∆∞u tr·ªØ</button>
            </div>

            <!-- Gallery Grid -->
            <div id="result-thumbnails" class="gallery-grid">
                <!-- Results injected by JS -->
            </div>

            <!-- Sticky Action Bar -->
            <div class="gallery-sticky-actions">
                <button id="download-lookbook-btn" class="action-pill-btn light">
                    <span class="material-symbols-outlined">download</span>
                    T·∫£i Lookbook
                </button>
                <button id="share-friends-btn" class="action-pill-btn dark">
                    <span class="material-symbols-outlined">ios_share</span>
                    Chia s·∫ª
                </button>
            </div>
        </section>


        <!-- Note: Result popups are now injected directly into the webpage for full-screen dragging -->

        <!-- Loading Overlay - Anime Style -->
        <div id="loading-overlay" class="loading-overlay hidden">
            <div class="loading-content-wrapper">
                <!-- Anime Character SVG -->
                <div class="anime-mascot">
                    <svg viewBox="0 0 200 200" class="chibi-character">
                        <defs>
                            <filter id="glow" x="-20%" y="-20%" width="140%" height="140%">
                                <feGaussianBlur stdDeviation="3" result="blur" />
                                <feComposite in="SourceGraphic" in2="blur" operator="over" />
                            </filter>
                            <linearGradient id="hairGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" stop-color="#FFD1DC" /> <!-- Light Pink -->
                                <stop offset="100%" stop-color="#FF9EAA" /> <!-- Darker Pink -->
                            </linearGradient>
                            <linearGradient id="dressGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" stop-color="#E0F7FA" />
                                <stop offset="100%" stop-color="#B2EBF2" />
                            </linearGradient>
                        </defs>

                        <!-- Glow effect behind -->
                        <circle cx="100" cy="100" r="70" fill="rgba(255, 255, 255, 0.5)" filter="url(#glow)"
                            class="mascot-glow" />

                        <!-- Body -->
                        <path d="M85 130 Q100 135 115 130 L125 180 Q100 190 75 180 Z" fill="url(#dressGrad)" />

                        <!-- Head -->
                        <circle cx="100" cy="90" r="45" fill="#FFE0BD" /> <!-- Skin -->

                        <!-- Hair (Back) -->
                        <path d="M60 90 Q50 150 40 160 Q80 150 100 150 Q120 150 160 160 Q150 150 140 90 Z"
                            fill="url(#hairGrad)" />

                        <!-- Face -->
                        <!-- Eyes -->
                        <ellipse cx="82" cy="95" rx="6" ry="8" fill="#5D4037" class="eye-blink" />
                        <ellipse cx="118" cy="95" rx="6" ry="8" fill="#5D4037" class="eye-blink" />
                        <!-- Blush -->
                        <ellipse cx="75" cy="105" rx="5" ry="3" fill="#FFAB91" opacity="0.6" />
                        <ellipse cx="125" cy="105" rx="5" ry="3" fill="#FFAB91" opacity="0.6" />
                        <!-- Mouth -->
                        <path d="M95 108 Q100 112 105 108" fill="none" stroke="#A1887F" stroke-width="2"
                            stroke-linecap="round" />

                        <!-- Hair (Bangs) -->
                        <path d="M55 90 Q60 50 100 45 Q140 50 145 90 Q140 70 100 75 Q60 70 55 90"
                            fill="url(#hairGrad)" />

                        <!-- Wand -->
                        <g class="wand-animation">
                            <line x1="130" y1="120" x2="150" y2="100" stroke="#FFCC80" stroke-width="4"
                                stroke-linecap="round" />
                            <path d="M150 100 L145 95 L150 90 L155 95 Z" fill="#FFD700" /> <!-- Star tip -->
                            <circle cx="150" cy="100" r="8" fill="none" stroke="#FFF" stroke-width="1" opacity="0.8" />
                        </g>

                        <!-- Sparkles -->
                        <g class="sparkles-group">
                            <text x="150" y="80" font-size="20" fill="#FFD700" class="sparkle-1">‚ú®</text>
                            <text x="40" y="120" font-size="16" fill="#81D4FA" class="sparkle-2">‚ú¶</text>
                            <text x="160" y="140" font-size="18" fill="#FF8A80" class="sparkle-3">‚ú®</text>
                        </g>
                    </svg>
                </div>

                <!-- Text & Progress -->
                <div class="loading-info">
                    <h3 id="loading-text" class="anime-title">ƒêang h√¥ bi·∫øn... ‚ú®</h3>

                    <div class="magic-progress-container">
                        <div class="magic-progress-bar">
                            <div id="loading-progress-bar" class="magic-progress-fill" style="width: 0%"></div>
                        </div>
                        <div class="magic-sparkle-follower"></div>
                    </div>

                    <p id="loading-progress-text" class="anime-percent">0%</p>
                    <p id="loading-tip" class="anime-tip">üí° AI ƒëang th·ª≠ ƒë·ªì cho b·∫°n ƒë√≥!</p>
                </div>
            </div>
        </div>

        <!-- Success Overlay - Anime Style -->
        <div id="success-overlay" class="loading-overlay hidden">
            <div class="loading-content-wrapper success-wrapper">
                <!-- Anime Character SVG (Happy/Celebratory) -->
                <div class="anime-mascot">
                    <svg viewBox="0 0 200 200" class="chibi-character">
                        <defs>
                            <filter id="glowSuccess" x="-20%" y="-20%" width="140%" height="140%">
                                <feGaussianBlur stdDeviation="3" result="blur" />
                                <feComposite in="SourceGraphic" in2="blur" operator="over" />
                            </filter>
                            <linearGradient id="hairGradSuccess" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" stop-color="#FFD1DC" />
                                <stop offset="100%" stop-color="#FF9EAA" />
                            </linearGradient>
                            <linearGradient id="dressGradSuccess" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" stop-color="#E0F7FA" />
                                <stop offset="100%" stop-color="#B2EBF2" />
                            </linearGradient>
                        </defs>

                        <!-- Glow effect behind -->
                        <circle cx="100" cy="100" r="70" fill="rgba(255, 255, 255, 0.6)" filter="url(#glowSuccess)"
                            class="mascot-glow" />

                        <!-- Body (Dancing/Happy Pose) -->
                        <path d="M85 130 Q100 135 115 130 L135 170 Q100 190 65 170 Z" fill="url(#dressGradSuccess)" />

                        <!-- Head -->
                        <circle cx="100" cy="90" r="45" fill="#FFE0BD" />

                        <!-- Hair (Back) -->
                        <path d="M60 90 Q50 150 40 160 Q80 150 100 150 Q120 150 160 160 Q150 150 140 90 Z"
                            fill="url(#hairGradSuccess)" />

                        <!-- Face (Happy Expression) -->
                        <!-- Eyes (Closed Happy ^ ^) -->
                        <path d="M75 95 Q82 85 89 95" fill="none" stroke="#5D4037" stroke-width="3"
                            stroke-linecap="round" />
                        <path d="M111 95 Q118 85 125 95" fill="none" stroke="#5D4037" stroke-width="3"
                            stroke-linecap="round" />

                        <!-- Blush -->
                        <ellipse cx="75" cy="105" rx="6" ry="4" fill="#FFAB91" opacity="0.6" />
                        <ellipse cx="125" cy="105" rx="6" ry="4" fill="#FFAB91" opacity="0.6" />

                        <!-- Mouth (Big Smile) -->
                        <path d="M90 110 Q100 120 110 110" fill="none" stroke="#A1887F" stroke-width="2"
                            stroke-linecap="round" />

                        <!-- Hair (Bangs) -->
                        <path d="M55 90 Q60 50 100 45 Q140 50 145 90 Q140 70 100 75 Q60 70 55 90"
                            fill="url(#hairGradSuccess)" />

                        <!-- V Sign Hand -->
                        <g transform="translate(135, 110) rotate(-20)">
                            <path d="M0 0 L5 -15 L10 0 L15 -15 L20 0 L10 20 Z" fill="#FFE0BD" />
                        </g>

                        <!-- Sparkles/Hearts -->
                        <g class="sparkles-group">
                            <text x="140" y="70" font-size="24" fill="#FF4081" class="sparkle-1">‚ô•</text>
                            <text x="50" y="80" font-size="20" fill="#FFD700" class="sparkle-2">‚ú®</text>
                            <text x="160" y="130" font-size="18" fill="#FF8A80" class="sparkle-3">‚ú®</text>
                        </g>
                    </svg>
                </div>

                <!-- Success Text -->
                <div class="loading-info">
                    <h3 class="anime-title success-title">Th√†nh c√¥ng! ‚ú®</h3>

                    <p id="success-message-text" class="anime-tip success-message">
                        Outfit n√†y tr√¥ng tuy·ªát v·ªùi!
                    </p>

                    <div class="success-actions">
                        <button id="success-close-btn" class="btn btn-primary btn-sm">
                            Xem k·∫øt qu·∫£
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Error Overlay - Anime Style -->
        <div id="error-overlay" class="loading-overlay hidden">
            <div class="loading-content-wrapper error-wrapper">
                <!-- Anime Character SVG (Sad/Confused) -->
                <div class="anime-mascot">
                    <svg viewBox="0 0 200 200" class="chibi-character">
                        <!-- Reusing defs from loading if possible, or re-defining -->
                        <defs>
                            <linearGradient id="hairGradErr" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" stop-color="#FFD1DC" />
                                <stop offset="100%" stop-color="#FF9EAA" />
                            </linearGradient>
                            <linearGradient id="dressGradErr" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" stop-color="#E0F7FA" />
                                <stop offset="100%" stop-color="#B2EBF2" />
                            </linearGradient>
                        </defs>

                        <!-- Body (Same) -->
                        <path d="M85 130 Q100 135 115 130 L125 180 Q100 190 75 180 Z" fill="url(#dressGradErr)" />

                        <!-- Head (Same) -->
                        <circle cx="100" cy="90" r="45" fill="#FFE0BD" />

                        <!-- Hair (Back) (Same) -->
                        <path d="M60 90 Q50 150 40 160 Q80 150 100 150 Q120 150 160 160 Q150 150 140 90 Z"
                            fill="url(#hairGradErr)" />

                        <!-- Face (Sad Expression) -->
                        <!-- Eyes (X shape or tearing) -->
                        <g class="sad-eyes">
                            <text x="75" y="100" font-size="20" fill="#5D4037" font-family="monospace"
                                font-weight="bold">></text>
                            <text x="115" y="100" font-size="20" fill="#5D4037" font-family="monospace"
                                font-weight="bold">
                                << /text>
                        </g>

                        <!-- Blush (Same) -->
                        <ellipse cx="75" cy="105" rx="5" ry="3" fill="#FFAB91" opacity="0.6" />
                        <ellipse cx="125" cy="105" rx="5" ry="3" fill="#FFAB91" opacity="0.6" />

                        <!-- Mouth (Wavy/Sad) -->
                        <path d="M90 115 Q100 110 110 115" fill="none" stroke="#A1887F" stroke-width="2"
                            stroke-linecap="round" />

                        <!-- Tear Drop Animation -->
                        <path d="M70 105 Q65 115 70 120 Q75 115 70 105" fill="#81D4FA" class="tear-drop"
                            opacity="0.8" />

                        <!-- Hair (Bangs) (Same) -->
                        <path d="M55 90 Q60 50 100 45 Q140 50 145 90 Q140 70 100 75 Q60 70 55 90"
                            fill="url(#hairGradErr)" />

                        <!-- Broken Wand / Question Mark -->
                        <text x="140" y="100" font-size="32" fill="#FFAB91" class="question-mark">?</text>
                    </svg>
                </div>

                <!-- Error Text -->
                <div class="loading-info">
                    <h3 class="anime-title error-title">Oops! C√≥ l·ªói r·ªìi... üòø</h3>

                    <p id="error-message-text" class="anime-tip error-message">
                        AI kh√¥ng th·ªÉ x·ª≠ l√Ω ·∫£nh n√†y ƒë∆∞·ª£c.
                    </p>

                    <div class="error-actions">
                        <button id="error-retry-btn" class="btn btn-primary btn-sm">
                            <span class="material-symbols-outlined">refresh</span>
                            Th·ª≠ l·∫°i
                        </button>
                        <button id="error-close-btn" class="btn btn-secondary btn-sm">
                            ƒê√≥ng
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="../lib/icons.js"></script>
    <script src="../lib/i18n.js"></script>
    <script src="image_cache_db.js"></script>
    <script src="gallery_helpers.js"></script>
    <script src="sidebar.js"></script>
</body>

</html>